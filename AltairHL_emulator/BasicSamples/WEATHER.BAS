100 WIDTH 150
200 PRINT "===================================================="
300 PRINT "OPEN WEATHER MAP IOT APP"
400 SECONDS% = 10
500 WEATHERKEY = 34
600 WEATHERVALUE = 35
700 WEATHERITEMS = 6
800 LOCATIONKEY = 36
900 LOCATIONVALUE = 37
1000 LOCATIONITEMS = 4
1100 POLLUTIONKEY = 38
1200 POLLUTIONVALUE = 39
1300 POLLUTIONITEMS = 9
1400 PRINT "PUBLISH WEATHER DATA TO IOT CENTRAL EVERY";SECONDS%;"SECONDS"
1500 RCOUNT% = 0
1600 READING# = 0
1700 WHILE 1
1800 READING# = READING# + 1
1900 PRINT "============================================================================================================================"
2000 PORT = 43 : GOSUB 4300 : TIME$ = RSTRING$
2100 PRINT "Reading", "Time"
2200 PRINT READING#,  TIME$
2300 ITEMKEY = WEATHERKEY : ITEMVALUE = WEATHERVALUE : ITEMS = WEATHERITEMS : GOSUB 3300
2400 PRINT
2500 ITEMKEY = POLLUTIONKEY : ITEMVALUE = POLLUTIONVALUE : ITEMS = POLLUTIONITEMS : GOSUB 3300
2600 PRINT
2700 ITEMKEY = LOCATIONKEY : ITEMVALUE = LOCATIONVALUE : ITEMS = LOCATIONITEMS : GOSUB 3300
2800 PRINT
2900 GOSUB 5400 : REM PUBLISH WEATHER DATA
3000 GOSUB 5000 : REM SLEEP
3100 WEND
3200 END
3300 REM PRINT ITEM KEY VALUE PAIRS
3400 PRINT
3500 FOR I = 1 TO ITEMS
3600 PORT = ITEMKEY : PDATA = I - 1 : GOSUB 4300 : PRINT RSTRING$, 
3700 NEXT I
3800 PRINT
3900 FOR I = 1 TO ITEMS
4000 PORT = ITEMVALUE : PDATA = I - 1 : GOSUB 4300 : PRINT RSTRING$, 
4100 NEXT I
4200 RETURN
4300 REM SUBROUTINE READS STRING DATA FROM PORT UNTIL NULL CHARACTER
4400 OUT PORT, PDATA
4500 RSTRING$ = ""
4600 C=INP(200)
4700 IF C = 0 THEN RETURN
4800 RSTRING$ = RSTRING$ + CHR$(C)
4900 GOTO 4600
5000 PRINT "" : PRINT CHR$(27) + "[31;22;24m" + "Sleep for"; SECONDS% ; "seconds." + CHR$(27) + "[0m"
5100 OUT 30, SECONDS%
5200 IF INP(30) = 1 THEN GOTO 5200
5300 RETURN
5400 REM PUBLISH WEATHER DATA
5500 REM WAIT FOR PUBLISH WEATHER PENDING TO GO FALSE
5600 WAIT 32, 1, 1
5700 REM PUBLISH TO IOT CENTRAL WITH JITTER
5800 OUT 32, 0
5900 RETURN